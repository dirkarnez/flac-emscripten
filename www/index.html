<html>

<body>
    <input type="file" id="myfile">
<script>
    


    var Module = {
      onRuntimeInitialized: function() {

        document.getElementById("myfile").addEventListener("change", function () {
            let files = document.getElementById('myfile').files;
            let file = files[0];

            let reader = new FileReader();
            reader.addEventListener('loadend', function (e) {
                let result = reader.result;
                const uint8_view = new Uint8Array(result);
                FS.writeFile('test.flac', uint8_view);
                Module.ccall('mains', 'number', ['number', 'string'], [2, 'test.flac']);
                var contents = FS.readFile('output.wav', { encoding: 'binary' });
                downloadBlob(contents, "dfsdf.wav", "audio/wav")
                debugger;
            });
            reader.readAsArrayBuffer(file);;
        })
      }
    };

    downloadBlob = function(data, fileName, mimeType) {
  var blob, url;
  blob = new Blob([data], {
    type: mimeType
  });
  url = window.URL.createObjectURL(blob);
  downloadURL(url, fileName);
  setTimeout(function() {
    return window.URL.revokeObjectURL(url);
  }, 1000);
};

downloadURL = function(data, fileName) {
  var a;
  a = document.createElement('a');
  a.href = data;
  a.download = fileName;
  document.body.appendChild(a);
  a.style = 'display: none';
  a.click();
  a.remove();
};
</script>

<script type="text/javascript" src="flac-playground.js"></script>
</body>

</html>